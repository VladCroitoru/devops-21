version: '3.9'

services:
  minitwut-app:
    image: heyjoakim/mt-cmp:latest
    build:
      context: .
    ports:
      - '8000:8000'
  datadog:
   links:
    - minitwut-app # Connect the Datadog Agent container to the Go container
   image: gcr.io/datadoghq/agent:latest
   labels:
    com.datadoghq.ad.logs: '[<LOGS_CONFIG>]'  
   environment:
    - DD_API_KEY=9c64667415632470399733edbdc94bb3
    - DD_LOGS_ENABLED=true
    - DD_CONTAINER_EXCLUDE_LOGS="name:datadog-agent"
    - DD_SITE=datadoghq.com
    - DD_DOGSTATSD_NON_LOCAL_TRAFFIC="true"
   volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
    - /proc/:/host/proc/:ro
    - /sys/fs/cgroup:/host/sys/fs/cgroup:ro
    - /opt/datadog-agent/run:/opt/datadog-agent/run:rw